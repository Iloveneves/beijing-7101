# STAUD top level makefile

DVD_MAKE_VERSION := 2
ifdef IN_OBJECT_DIR

include $(DVD_MAKE)/generic.mak

COMPONENT_NAME := staudlx
ST20_TARGETS := $(COMPONENT_NAME).lib
ST20_EXPORTS := $(COMPONENT_NAME).h $(COMPONENT_NAME).lib
ST40_TARGETS := $(call ST20LIB_TO_ST40LIB,$(ST20_TARGETS))
ST40_EXPORTS := $(call ST20LIB_TO_ST40LIB,$(ST20_EXPORTS))
ST200_TARGETS := $(call ST20LIB_TO_ST200LIB,$(ST20_TARGETS))
ST200_EXPORTS := $(call ST20LIB_TO_ST200LIB,$(ST20_EXPORTS))

STAUD_CFLAGS :=

# Pick up standars rules
#-----------------------
include $(DVD_MAKE)/defrules.mak

# No component in the top-level : run make in ./src
#---------------------------------------------------
FULLDIR := $(DVD_BUILD_DIR)/src/objs/$(OBJECT_DIRECTORY)

ifeq "$(findstring $(DVD_FRONTEND),5105 5107 5162)" "$(DVD_FRONTEND)"
STAUD_CFLAGS += -DST_51XX -cpp
ST_51XX := 1
STAUD_REMOVE_EMBX := 1
export ST_51XX
export STAUD_REMOVE_EMBX
endif

ifdef ST_51XX
	ifndef STAUDLX_UNINSTALL_AC3_DDP
	STAUD_CFLAGS += -DSTAUD_INSTALL_AC3
	endif
	ifndef STAUDLX_UNINSTALL_MPEG
	STAUD_CFLAGS += -DSTAUD_INSTALL_MPEG
	endif
	ifdef PCM_SUPPORT
		ifndef STAUDLX_UNINSTALL_CDDA_PCM
		STAUD_CFLAGS += -DSTAUD_INSTALL_CDDA
		endif
	endif
	ifdef AD_SUPPORT
		ifndef STAUDLX_UNINSTALL_CDDA_PCM
		STAUD_CFLAGS += -DSTAUD_INSTALL_CDDA
		endif
	endif
else 
	ifndef STAUDLX_UNINSTALL_AC3_DDP
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_AC3
	endif
	
	ifndef STAUDLX_UNINSTALL_MPEG
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_MPEG
	endif
	
	ifndef STAUDLX_UNINSTALL_HEAAC
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_HEAAC
	endif
	
	ifndef STAUDLX_UNINSTALL_DTS
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_DTS
	endif
	
	ifndef STAUDLX_UNINSTALL_CDDA_PCM
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_CDDA
	endif
	ifndef STAUDLX_UNINSTALL_MLP
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_MLP
	endif
	ifndef STAUDLX_UNINSTALL_LPCMV
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_LPCMV
	endif
	ifndef STAUDLX_UNINSTALL_LPCMA
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_LPCMA
	endif
	ifndef STAUDLX_UNINSTALL_WMA
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_WMA
	endif
	ifndef STAUDLX_UNINSTALL_WMAPRO
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_WMAPROLSL
	endif
	ifndef STAUD_UNINSTALL_WAVE
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_WAVE
	endif
	ifndef STAUD_UNINSTALL_AIFF
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_AIFF
	endif
	ifdef STAUDLX_ALSA_SUPPORT
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_ALSA
	endif
	
	ifndef STAUDLX_UNINSTALL_AAC
		STAUD_CFLAGS := $(STAUD_CFLAGS)  -DSTAUD_INSTALL_AAC
	endif
endif

ifdef STAUD_REMOVE_EMBX
STAUD_CFLAGS += -DSTAUD_REMOVE_EMBX
endif
ifdef ST_51XX
STAUD_CFLAGS += -fspace
endif
ifdef STAUD_REMOVE_CLKRV_SUPPORT
STAUD_CFLAGS += -D STAUD_REMOVE_CLKRV_SUPPORT
endif
ifdef STAUD_REMOVE_PTI_SUPPORT
STAUD_CFLAGS += -D STAUD_REMOVE_PTI_SUPPORT
endif
ifdef STAUD_DEBUG
STAUD_CFLAGS += -D STAUD_DEBUG -D STTBX_REPORT -D STTBX_PRINT
endif

CFLAGS := $(STAUD_CFLAGS)
export STAUD_CFLAGS
ifeq "$(ARCHITECTURE)" "ST20"
$(ST20_TARGETS): $(FULLDIR)/$(ST20_TARGETS)
	$(CP) $(subst $(BAD_SLASH),$(GOOD_SLASH),$< $@ > $(NULL))
$(FULLDIR)/$(ST20_TARGETS): FORCE
	$(MAKE) -C $(DVD_BUILD_DIR)/src
endif

ifeq "$(ARCHITECTURE)" "ST40"
$(ST40_TARGETS): $(FULLDIR)/$(ST40_TARGETS)
	$(CP) $(subst $(BAD_SLASH),$(GOOD_SLASH),$< $@ > $(NULL))
$(FULLDIR)/$(ST40_TARGETS): FORCE
	$(MAKE) -C $(DVD_BUILD_DIR)/src
endif

ifeq "$(ARCHITECTURE)" "ST200"
$(ST200_TARGETS): $(FULLDIR)/$(ST200_TARGETS)
	$(CP) $(subst $(BAD_SLASH),$(GOOD_SLASH),$< $@ > $(NULL))
$(FULLDIR)/$(ST200_TARGETS): FORCE
	$(MAKE) -C $(DVD_BUILD_DIR)/src
endif

# Clean the lib
#--------------
clean: subdir_clean
	-$(RM) $($(ARCHITECTURE)_TARGETS)
subdir_clean:
	$(MAKE) -C $(DVD_BUILD_DIR)/src clean

FORCE:

else

include $(DVD_MAKE)/builddir.mak

endif

# End of STAUD top level makefile
